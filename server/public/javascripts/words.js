(()=>{const t="/word",e=document.getElementById("content"),n=document.getElementById("categoryForm"),o=document.getElementById("categorieInput"),a=document.getElementById("categoriesList"),r=document.getElementById("wordsModal"),i=document.getElementById("modalTitle"),d=document.querySelector(".close-btn"),c=document.getElementById("wordForm"),s=document.getElementById("mot"),l=document.getElementById("saveWordBtn"),m=document.getElementById("wordsTable");let u=[],p=null,f=null;function g(t,n=!1){e.innerHTML=`<div class="${n?"error-message":"success-message"}">${t}</div>`,setTimeout((()=>e.innerHTML=""),3e3)}async function y(){a.innerHTML="";try{const e=await fetch(t);if(!e.ok)throw new Error(`Erreur ${e.status}`);const n=await e.json(),o=[...new Set(n.map((t=>t.categorie)))];u=o,u.forEach((t=>{const e=document.createElement("div");e.className="category-item",e.innerHTML=`\n        <span>${t}</span>\n        <div>\n          <button data-action="open" data-cat="${t}">Ouvrir</button>\n          <button data-action="deleteCat" data-cat="${t}">Supprimer</button>\n        </div>\n      `,a.appendChild(e)}))}catch(t){g(t.message,!0),console.error(t)}}async function E(e){m.innerHTML="";try{const n=await fetch(t);if(!n.ok)throw new Error(`Erreur ${n.status}`);(await n.json()).filter((t=>t.categorie===e)).forEach((t=>{const e=document.createElement("tr");e.innerHTML=`\n        <td contenteditable data-field="mot" data-id="${t._id}">${t.mot}</td>\n        <td>\n          <button data-action="update" data-id="${t._id}">Modifier</button>\n          <button data-action="delete" data-id="${t._id}">Supprimer</button>\n        </td>\n      `,m.appendChild(e)}))}catch(t){g(t.message,!0),console.error(t)}}n.addEventListener("submit",(async e=>{e.preventDefault();const n=document.getElementById("motInput"),a=n.value.split(",").map((t=>t.trim())).filter(Boolean),r=o.value.trim();if(r&&!u.includes(r))try{await Promise.all(a.map((e=>fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mot:e,categorie:r})})))),o.value="",n.value="",g("Catégorie ajoutée avec mot(s)"),y()}catch(t){g(t.message,!0),console.error(t)}})),a.addEventListener("click",(e=>{const n=e.target,o=n.dataset.action,a=n.dataset.cat;if(o&&a){if("deleteCat"===o){if(!confirm(`Supprimer la catégorie "${a}" et tous ses mots ?`))return;fetch(t).then((t=>t.json())).then((t=>t.filter((t=>t.categorie===a)))).then((e=>Promise.all(e.map((e=>fetch(`${t}/${e._id}`,{method:"DELETE"})))))).then((()=>{g(`Catégorie "${a}" supprimée`),y()}))}"open"===o&&(p=a,i.textContent=`Mots de la catégorie « ${a} »`,r.style.display="flex",E(a))}})),d.addEventListener("click",(()=>{r.style.display="none",c.reset(),f=null,l.textContent="Ajouter"})),window.addEventListener("click",(t=>{t.target===r&&d.click()})),c.addEventListener("submit",(async e=>{e.preventDefault();const n=s.value.split(",").map((t=>t.trim())).filter(Boolean);if(0!==n.length&&p)try{if(f){const e={mot:n[0],categorie:p},o=await fetch(`${t}/${f}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!o.ok)throw new Error(`Erreur ${o.status}`)}else await Promise.all(n.map((e=>fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mot:e,categorie:p})}))));g(f?"Mot mis à jour":"Mot(s) ajouté(s)"),c.reset(),f=null,l.textContent="Ajouter",E(p),y()}catch(t){g(t.message,!0),console.error(t)}})),m.addEventListener("click",(e=>{const n=e.target,o=n.dataset.action,a=n.dataset.id;if(o&&a){if("delete"===o){if(!confirm("Supprimer ce mot ?"))return;fetch(`${t}/${a}`,{method:"DELETE"}).then((()=>{g("Mot supprimé"),E(p),y()}))}if("update"===o){const t=document.querySelector(`td[data-field="mot"][data-id="${a}"]`);s.value=t.textContent.trim(),f=a,l.textContent="Mettre à jour"}}})),document.addEventListener("DOMContentLoaded",y)})();