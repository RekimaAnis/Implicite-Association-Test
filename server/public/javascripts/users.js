(()=>{const e="/user/schema/category",t=document.getElementById("content"),n=document.getElementById("categoryForm"),a=document.getElementById("categoryNameInput"),o=document.getElementById("categoryTypeInput"),r=document.getElementById("categoriesList");let s=null;function l(e,n=!1){t.innerHTML=`<div class="${n?"error-message":"success-message"}">${e}</div>`,setTimeout((()=>t.innerHTML=""),3e3)}async function c(){r.innerHTML="";try{const t=await fetch(e);if(!t.ok)throw new Error(`Erreur ${t.status}`);const n=await t.json();s=n,n.forEach((t=>{const n=document.createElement("section");n.className="category-section";const a=document.createElement("div");if(a.className="category-header",a.innerHTML=`<h3>${t.name}</h3>`,"String"===t.type){const e=document.createElement("button");e.textContent="Ouvrir",e.addEventListener("click",(()=>function(e,t){const n=e.querySelector(".value-list"),a=e.querySelector(".add-value-form");"none"===n.style.display?(n.innerHTML="",(t.allowedValues||[]).forEach((e=>{const a=document.createElement("li"),o=document.createElement("span");o.textContent=e;const r=document.createElement("button");r.textContent="‚úèÔ∏è",r.addEventListener("click",(async()=>{const n=prompt("Modifier la valeur :",e);if(!n||!n.trim())return;const a=t.allowedValues.map((t=>t===e?n.trim():t));await i(t._id,[...new Set(a)])}));const s=document.createElement("button");s.textContent=" üóëÔ∏è",s.addEventListener("click",(async()=>{const n=t.allowedValues.filter((t=>t!==e));await i(t._id,n)})),a.appendChild(o),a.appendChild(r),a.appendChild(s),n.appendChild(a)})),n.style.display="block",a.style.display="flex"):(n.style.display="none",a.style.display="none")}(n,t))),a.appendChild(e)}else{const e=document.createElement("em");e.textContent=" (valeurs libres)",a.appendChild(e)}const o=document.createElement("button");o.textContent="Supprimer",o.addEventListener("click",(async()=>{confirm(`Supprimer la cat√©gorie "${t.name}" ?`)&&(await fetch(`${e}/${t._id}`,{method:"DELETE"}),l(`Cat√©gorie "${t.name}" supprim√©e`),c())})),a.appendChild(o),n.appendChild(a);const s=document.createElement("ul");s.className="value-list",s.style.display="none",n.appendChild(s);const d=document.createElement("form");d.className="add-value-form",d.innerHTML='\n        <input type="text" placeholder="Nouvelle(s) valeur(s) s√©par√©e(s) par des virgules" required />\n        <button type="submit">Ajouter</button>\n      ',d.style.display="none",d.addEventListener("submit",(async e=>{e.preventDefault();const n=d.querySelector("input"),a=n.value.split(",").map((e=>e.trim())).filter(Boolean);if(0===a.length)return;const o=new Set(t.allowedValues||[]);a.forEach((e=>o.add(e))),await i(t._id,[...o]),n.value=""})),n.appendChild(d),r.appendChild(n)}))}catch(e){l(e.message,!0),console.error(e)}}async function i(t,n){try{if(!(await fetch(`${e}/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({allowedValues:n})})).ok)throw new Error("Erreur mise √† jour");l("Valeurs mises √† jour"),c()}catch(e){l(e.message,!0),console.error(e)}}n.addEventListener("submit",(async t=>{t.preventDefault();const n=a.value.trim(),r=o.value;if(n&&r)try{if(!(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,type:r,allowedValues:[]})})).ok)throw new Error("Erreur lors de la cr√©ation de la cat√©gorie");a.value="",l("Cat√©gorie ajout√©e"),c()}catch(e){l(e.message,!0),console.error(e)}})),document.addEventListener("DOMContentLoaded",c)})();