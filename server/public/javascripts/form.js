(()=>{const e=document.getElementById("content"),t=document.getElementById("userForm");let n=null;function o(t,n=!1){e.innerHTML=`<div class="${n?"error-message":"success-message"}">${t}</div>`,setTimeout((()=>e.innerHTML=""),3e3)}t.addEventListener("submit",(async e=>{e.preventDefault();const r=function(){const e={};return n.fields.forEach((t=>{const n=document.getElementById(t);n&&(e[t]=n.value)})),e}();for(const e of n.fields){const t=document.getElementById(e);if(!t||!t.value)return void o(`Le champ "${e}" est requis.`,!0)}try{const e=await fetch("/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok){const t=await e.json();throw new Error(t.error||"Erreur serveur")}o("Réponse envoyée avec succès"),t.reset()}catch(e){console.error(e),o(e.message,!0)}})),document.addEventListener("DOMContentLoaded",(async function(){try{const e=await fetch("/user/schema/category"),o=await e.json();n={fields:o.map((e=>e.name)),allowedValues:Object.fromEntries(o.map((e=>[e.name,"String"===e.type?e.allowedValues:null])))},o.forEach((e=>{const n=document.createElement("div");n.classList.add("form-group");const o=document.createElement("label");let r;if(o.htmlFor=e.name,o.textContent=e.name.charAt(0).toUpperCase()+e.name.slice(1),"String"===e.type&&Array.isArray(e.allowedValues)&&e.allowedValues.length>0){r=document.createElement("select");const t=document.createElement("option");t.value="",t.textContent="Choisir...",t.disabled=!0,t.selected=!0,r.appendChild(t),e.allowedValues.forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,r.appendChild(t)}))}else r=document.createElement("input"),r.type="Number"===e.type?"number":"text";r.id=e.name,r.name=e.name,r.required=!0,n.append(o,r),t.insertBefore(n,t.querySelector("div").nextSibling)}))}catch(e){console.error(e),o("Impossible de charger le formulaire",!0)}}))})();